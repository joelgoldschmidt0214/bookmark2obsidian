# 実装計画

- [x] 1. Python仮想環境とプロジェクト基盤の構築
  - uvを使用してPython仮想環境を作成し、プロジェクトを初期化する
  - pyproject.tomlファイルを作成し、必要な依存関係（streamlit、beautifulsoup4、requests、pathlib）を定義する
  - 仮想環境内に依存関係をインストールし、開発環境を整備する
  - _要件: 1.1_

- [x] 2. Streamlit基本構造の実装
  - app.pyの基本的なStreamlitアプリケーション構造を作成し、ページタイトルと基本レイアウトを実装する
  - Streamlitアプリケーションが正常に起動することを確認するテストを実行する
  - _要件: 1.1_

- [x] 3. ファイルアップロードとディレクトリ選択機能の実装
  - Streamlitのfile_uploaderを使用してbookmarks.htmlファイルのアップロード機能を実装する
  - ディレクトリ選択機能（text_inputまたはselectbox）を実装し、パス存在確認とアクセス権限検証を追加する
  - アップロードされたファイルの妥当性検証（HTMLファイル形式、ブックマーク構造の確認）を実装する
  - _要件: 1.1, 1.2, 1.3_

- [x] 4. ブックマーク解析機能の実装
  - BookmarkParserクラスを実装し、BeautifulSoup4を使用してbookmarks.htmlから`<a>`タグを抽出する機能を作成する
  - ディレクトリ階層構造とページ名、URLを抽出し、Bookmarkデータクラスに格納する機能を実装する
  - ドメインルートURL（例：https://example.com/）の検出と除外機能を実装する
  - _要件: 2.1, 2.4_

- [x] 5. ローカルディレクトリ構造解析と重複チェック機能の実装
  - LocalDirectoryManagerクラスを実装し、指定されたディレクトリの既存ファイル構造を読み取る機能を作成する
  - ブックマーク階層と既存ディレクトリ構造を比較し、同階層に同名ファイルが存在するページを特定する機能を実装する
  - 重複ページを除外リストに追加し、処理対象から除外する機能を実装する
  - _要件: 2.2, 2.3_

- [x] 6. Webスクレイピング基盤機能の実装
  - WebScraperクラスを実装し、urllib.robotparserを使用してrobots.txt確認機能を作成する
  - requestsライブラリを使用してWebページのHTMLソースコード取得機能を実装する
  - ドメインごとのURL整理機能と適切な待ち時間（2-5秒）を設けるレート制限機能を実装する
  - _要件: 3.1, 3.2_

- [x] 7. 記事本文抽出とコンテンツ検証機能の実装
  - BeautifulSoup4を使用してHTMLから記事本文を抽出する機能を実装する
  - 記事本文が適切に取得できているかを検証し、取得失敗時は除外リストに追加する機能を実装する
  - タグ情報の抽出機能を実装し、不要な要素（広告、ナビゲーション等）を除去する
  - _要件: 3.3, 3.4_

- [x] 8. Obsidian形式Markdown生成機能の実装
  - MarkdownGeneratorクラスを実装し、YAML front matterを含むObsidian形式のMarkdownを生成する機能を作成する
  - 記事本文をMarkdown形式に変換し、Obsidianのタグ形式（#タグ名）に対応する機能を実装する
  - 元のブックマーク階層構造を維持したファイルパス生成機能を実装する
  - _要件: 4.1, 4.2, 4.3_

- [x] 9. ページ一覧表示とプレビュー機能の実装
  - Streamlitを使用して展開可能なディレクトリツリー形式でページ一覧を表示する機能を実装する
  - ページ名クリック時のプレビュー表示機能（記事タイトル、URL、抽出された本文の一部）を実装する
  - 各ページにチェックボックスを配置し、デフォルトでチェック済み状態にする機能を実装する
  - _要件: 5.1, 5.2, 5.3_

- [ ] 10. 進捗表示とエラーハンドリング機能の実装
  - Streamlitのprogress barを使用して処理進捗を表示する機能を実装する
  - ネットワークエラー、ファイルアクセスエラー、スクレイピングエラーの包括的なエラーハンドリングを実装する
  - エラーログ記録機能とユーザーへの適切なエラーメッセージ表示機能を実装する
  - _要件: 6.1, 6.2, 6.3, 6.4_

- [ ] 11. ファイル保存機能とユーザー選択制御の実装
  - ユーザーがチェックしたページのみを対象とする選択制御機能を実装する
  - 「保存」ボタンクリック時にMarkdownファイルをローカルディレクトリに保存する機能を実装する
  - ディレクトリ構造の自動作成とファイル名の重複回避機能を実装する
  - _要件: 5.4_

- [ ] 12. 統合テストとエラーケース対応の実装
  - 全体フローの統合テスト用のサンプルデータ（テスト用bookmarks.html）を作成する
  - エッジケース（空のブックマーク、無効なURL、アクセス不可サイト）の処理を実装する
  - ユーザビリティ向上のための最終調整（メッセージ表示、レイアウト改善）を実装する
  - _要件: 全要件の統合確認_